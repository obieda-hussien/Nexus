# ุฏููู ุฅุนุฏุงุฏ Cloud Firestore ููุฎุทุฉ ุงููุฌุงููุฉ ๐ง

## ุงููุดููุฉ: ููุงุฐุง ูุง ุชุธูุฑ ุจูุงูุงุช ุงููุณุชุฎุฏูุ ๐ค

ุนูุฏูุง ุชููู ุจุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ ูู ุงููููุนุ ูุฏ ุชูุงุฌู ุงููุดุงูู ุงูุชุงููุฉ:
- โ ุชุณุฌูู ุงูุฏุฎูู ูุนูู ุจูุฌุงุญ
- โ ุดุงุดุฉ ุงูุชุญููู ุชุณุชูุฑ ุฅูู ูุง ูุง ููุงูุฉ
- โ ูุง ุชุธูุฑ ุจูุงูุงุช ุงููุณุชุฎุฏู ูู ููุญุฉ ุงูุชุญูู
- โ ูุง ุชูุฌุฏ ุจูุงูุงุช ูู Firestore Database

## ุงูุณุจุจ: ููุงุนุฏ ุงูุฃูุงู ูู Firestore ๐

Firebase Cloud Firestore ูุฃุชู ุจููุงุนุฏ ุฃูุงู ุงูุชุฑุงุถูุฉ **ุชููุน ุฌููุน ุนูููุงุช ุงููุฑุงุกุฉ ูุงููุชุงุจุฉ**. ุญุชู ูู ูุงู Firestore ูู "ูุถุน ุงูุงุฎุชุจุงุฑ"ุ ูุฅู ูุฐุง ุงููุถุน ูู ูุฏุฉ ุงูุชูุงุก ุตูุงุญูุฉ (ุนุงุฏุฉ 30 ูููุงู).

## ุงูุญู ุงูุดุงูู: ุฅุนุฏุงุฏ ููุงุนุฏ Firestore ุงูุตุญูุญุฉ โ๏ธ

### ุงูุฎุทูุฉ 1: ุงููุตูู ุฅูู Firebase Console

1. ุงูุชูู ุฅูู [Firebase Console](https://console.firebase.google.com/)
2. ุงุฎุชุฑ ูุดุฑูุน **nexus-012**
3. ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉุ ุงุฎุชุฑ **Firestore Database**

### ุงูุฎุทูุฉ 2: ุงูุนุซูุฑ ุนูู ุชุจููุจ Rules

ููุงู ุทุฑููุชุงู ูููุตูู ุฅูู ููุงุนุฏ Firestore:

#### ุงูุทุฑููุฉ ุงูุฃููู (ุงูุฃูุซุฑ ุดููุนุงู):
- ูู ุตูุญุฉ Firestore Database ุงูุฑุฆูุณูุฉ
- ุงุจุญุซ ุนู ุชุจููุจุงุช ูู ุงูุฃุนูู: **Data** | **Rules** | **Indexes** | **Usage**
- ุงุฎุชุฑ ุชุจููุจ **Rules**

#### ุงูุทุฑููุฉ ุงูุซุงููุฉ (ุฅุฐุง ูู ุชุฌุฏ ุงูุชุจููุจุงุช):
- ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉุ ุงุฎุชุฑ **Build** โ **Firestore Database**
- ุซู ุงุจุญุซ ุนู **Rules** ูู ุงููุงุฆูุฉ ุงููุฑุนูุฉ

### ุงูุฎุทูุฉ 3: ูุณุฎ ููุงุนุฏ ุงูุฃูุงู ุงูุฌุฏูุฏุฉ

ุงุณุชุจุฏู ุงููุญุชูู ุงูููุฌูุฏ ูู ูุญุฑุฑ ุงูููุงุนุฏ ุจุงูููุงุนุฏ ุงูุชุงููุฉ:

```javascript
// ููุงุนุฏ Cloud Firestore ููุฎุทุฉ ุงููุฌุงููุฉ - Nexus Educational Platform
// ุชุญุฏูุซ: ุฏูุณูุจุฑ 2024
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // ===== ููุงุนุฏ ุงููุณุชุฎุฏููู =====
    // ูู ูุณุชุฎุฏู ูุณุฌู ููููู ูุฑุงุกุฉ ููุชุงุจุฉ ุจูุงูุงุชู ุงูุดุฎุตูุฉ ููุท
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // ===== ููุงุนุฏ ุงูููุฑุณุงุช =====
    // ูุฑุงุกุฉ ุนุงูุฉ ููููุฑุณุงุชุ ูุชุงุจุฉ ูููุณุฌููู ููุท
    match /courses/{courseId} {
      allow read: if true; // ูุฑุงุกุฉ ุนุงูุฉ ููุฌููุน
      allow write: if request.auth != null; // ูุชุงุจุฉ ูููุณุฌููู ููุท
    }
    
    // ===== ููุงุนุฏ ุงูุฏุฑูุณ =====
    // ููุณ ููุงุนุฏ ุงูููุฑุณุงุช
    match /lessons/{lessonId} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // ===== ููุงุนุฏ ุชูุฏู ุงููุณุชุฎุฏููู =====
    // ูู ูุณุชุฎุฏู ููููู ูุฑุงุกุฉ ููุชุงุจุฉ ุชูุฏูู ููุท
    match /user_progress/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // ===== ููุงุนุฏ ุงูุชุญูููุงุช =====
    // ูููุณุฌููู ููุท
    match /analytics_events/{eventId} {
      allow read, write: if request.auth != null;
    }
    
    // ===== ููุงุนุฏ ุณุฌูุงุช ุงูุฃูุงู =====
    // ูููุณุฌููู ููุท
    match /security_logs/{logId} {
      allow read, write: if request.auth != null;
    }
    
    // ===== ูุงุนุฏุฉ ุงุฎุชุจุงุฑ ุงูุงุชุตุงู =====
    // ูููุฉ ููุชุดุฎูุต ูุงูุชุญูู ูู ุนูู ุงููุธุงู
    match /test/{testId} {
      allow read, write: if true;
    }
  }
}
```

### ุงูุฎุทูุฉ 4: ูุดุฑ ุงูููุงุนุฏ

1. ุจุนุฏ ูุณุฎ ุงูููุงุนุฏ ูู ุงููุญุฑุฑ
2. ุงุถุบุท ุนูู ุฒุฑ **Publish** (ูุดุฑ)
3. ุงูุชุธุฑ ุฑุณุงูุฉ ุงูุชุฃููุฏ "Rules published successfully"

## ุงุฎุชุจุงุฑ ุงูุฅุตูุงุญ ๐งช

### ููุญุณุงุจุงุช ุงูุฌุฏูุฏุฉ:

1. **ุณุฌู ุฎุฑูุฌ** ูู ุฃู ุญุณุงุจ ููุฌูุฏ
2. **ุฃูุดุฆ ุญุณุงุจ ุฌุฏูุฏ** ุจุฅูููู ููููุฉ ูุฑูุฑ ุฌุฏูุฏุฉ
3. **ูุฌุจ ุฃู ูุญุฏุซ ุงูุชุงูู**:
   - ุฅูุดุงุก ุงูุญุณุงุจ ุจูุฌุงุญ
   - ุญูุธ ุจูุงูุงุช ุงููุณุชุฎุฏู ูู Firestore
   - ุธููุฑ ููุญุฉ ุงูุชุญูู ูุจุงุดุฑุฉ (ุจุฏูู ุชุญููู ูุณุชูุฑ)

### ููุญุณุงุจุงุช ุงูููุฌูุฏุฉ (ูุจู ุงูุฅุตูุงุญ):

1. **ุณุฌู ุฏุฎูู** ุจุญุณุงุจ ููุฌูุฏ
2. ุฅุฐุง ุธูุฑุช ุดุงุดุฉ ุงูุชุญูููุ ุงุจุญุซ ุนู ุฒุฑ **"ุฅูุดุงุก ููู ุดุฎุตู"**
3. **ุงุถุบุท ุนูู ุงูุฒุฑ** ูุฅูุดุงุก ุงูุจูุงูุงุช ุงูููููุฏุฉ
4. **ุณุชุธูุฑ ููุญุฉ ุงูุชุญูู** ูุน ุจูุงูุงุช ุงููุณุชุฎุฏู

## ุงูุชุญูู ูู ุงูุจูุงูุงุช ูู Firebase Console ๐

### ูุญุต ูุฌููุนุฉ Users:

1. ุงูุชูู ุฅูู **Firestore Database** โ **Data**
2. ุงุจุญุซ ุนู ูุฌููุนุฉ ุชุณูู **users**
3. ูุฌุจ ุฃู ุชุฌุฏ ูุณุชูุฏุงุช ุจุฃุณูุงุก ุชุทุงุจู UID ุงููุณุชุฎุฏููู
4. ูู ูุณุชูุฏ ูุฌุจ ุฃู ูุญุชูู ุนูู:
   - `displayName`: ุงุณู ุงููุณุชุฎุฏู
   - `email`: ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
   - `role`: ุงูุฏูุฑ (student)
   - `createdAt`: ุชุงุฑูุฎ ุงูุฅูุดุงุก
   - `preferences`: ุงูุชูุถููุงุช

### ุงูุชุดุฎูุต ุจุงุณุชุฎุฏุงู ูุญุฏุฉ ุงูุชุญูู:

1. ุงูุชุญ ุงููููุน ูู ุงููุชุตูุญ
2. ุงุถุบุท F12 ููุชุญ ูุญุฏุฉ ุงูุชุญูู
3. ุงุจุญุซ ุนู ุงูุฑุณุงุฆู ุงูุชุงููุฉ:
   - โ `Firestore connection successful` = ุงูุงุชุตุงู ูุนูู
   - โ `User profile saved to Firestore successfully` = ุญูุธ ุงูุจูุงูุงุช ูุฌุญ
   - โ `Permission denied` = ูุดููุฉ ูู ููุงุนุฏ ุงูุฃูุงู

## ุฑุณุงุฆู ุงูุฎุทุฃ ุงูุดุงุฆุนุฉ ูุญููููุง ๐จ

### 1. "Permission denied"
**ุงูุณุจุจ**: ููุงุนุฏ ุงูุฃูุงู ุชููุน ุงูุนูููุฉ  
**ุงูุญู**: ุชุญุฏูุซ ููุงุนุฏ Firestore ููุง ูู ููุถุญ ุฃุนูุงู

### 2. "Missing or insufficient permissions"
**ุงูุณุจุจ**: ุงููุณุชุฎุฏู ุบูุฑ ูุณุฌู ุฃู ุงูููุงุนุฏ ุฎุงุทุฆุฉ  
**ุงูุญู**: ุชุฃูุฏ ูู ุชุณุฌูู ุงูุฏุฎูู ูุตุญุฉ ุงูููุงุนุฏ

### 3. "Document not found"
**ุงูุณุจุจ**: ูู ูุชู ุฅูุดุงุก ุงูููู ุงูุดุฎุตู ุจุนุฏ  
**ุงูุญู**: ุงุณุชุฎุฏู ุฒุฑ "ุฅูุดุงุก ููู ุดุฎุตู" ูู ููุญุฉ ุงูุชุญูู

### 4. "Firebase: Error (auth/network-request-failed)"
**ุงูุณุจุจ**: ูุดููุฉ ูู ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช ุฃู ุญุฌุจ Firebase  
**ุงูุญู**: ุชุญูู ูู ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช ูุฅุนุฏุงุฏุงุช ุงูุฌุฏุงุฑ ุงููุงุฑู

## ููุงุนุฏ ุฃูุงู ูุชูุฏูุฉ (ููุฅูุชุงุฌ) ๐ก๏ธ

ุนูุฏ ูุดุฑ ุงููุดุฑูุน ุฑุณููุงูุ ููููู ุงุณุชุฎุฏุงู ููุงุนุฏ ุฃูุซุฑ ุชูููุฏุงู:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // ููุงุนุฏ ุตุงุฑูุฉ ูููุณุชุฎุฏููู
    match /users/{userId} {
      allow read, write: if request.auth != null 
        && request.auth.uid == userId
        && request.auth.token.email_verified == true;
    }
    
    // ูุฑุงุกุฉ ุงูููุฑุณุงุช ูููุณุฌููู ููุท ูุน ุชุญูู ูู ุงูุจุฑูุฏ
    match /courses/{courseId} {
      allow read: if request.auth != null 
        && request.auth.token.email_verified == true;
      allow write: if request.auth != null 
        && get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role in ['admin', 'instructor'];
    }
    
    // ููุงุนุฏ ุชูุตูููุฉ ููุฏุฑูุณ
    match /lessons/{lessonId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null 
        && get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role in ['admin', 'instructor'];
    }
    
    // ุชูุฏู ุงููุณุชุฎุฏููู ูุน ุงูุชุญูู ูู ุงูููููุฉ
    match /user_progress/{userId} {
      allow read, write: if request.auth != null 
        && request.auth.uid == userId
        && request.auth.token.email_verified == true;
    }
    
    // ุณุฌูุงุช ูุญุฏูุฏุฉ ุจูุงุกู ุนูู ุงูุฏูุฑ
    match /security_logs/{logId} {
      allow read: if request.auth != null 
        && get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
      allow write: if request.auth != null;
    }
  }
}
```

## ุฎุตุงุฆุต ุงููุธุงู ุงููุญุณูุฉ ๐

### ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุงูุฐููุฉ:
- ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุงูุชููุงุฆูุฉ ุนูุฏ ูุดู ุงูุญูุธ
- ุขููุงุช ุงุญุชูุงุทูุฉ ูุชุนุฏุฏุฉ ููุญูุธ
- ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ููุงุจูุฉ ููููู
- ุชุดุฎูุต ููุตู ูู ูุญุฏุฉ ุงูุชุญูู

### ูุงุฌูุฉ ูุณุชุฎุฏู ูุญุณูุฉ:
- ูุคุดุฑุงุช ุญุงูุฉ ุงูุชุญููู ุงูุฐููุฉ
- ุฃุฒุฑุงุฑ ุงูุฅููุงุฐ ูุฅูุดุงุก ุงูููู ุงูุดุฎุตู ูุฏููุงู
- ุฑุณุงุฆู ุชูุฌูููุฉ ูููุณุชุฎุฏู
- ุชุตููู ูุชุฌุงูุจ ูุน ุงูุซูู ุงููุธูู

### ุงูุชูุงูู ูุน ุงูุฎุทุฉ ุงููุฌุงููุฉ:
- ูุง ูุณุชุฎุฏู Firebase Storage (ุบูุฑ ูุชููุฑ ูู ุงูุฎุทุฉ ุงููุฌุงููุฉ)
- ุชุญุณูู ุงุณุชุนูุงูุงุช Firestore ูุชูููุฑ ุงูููุชุง
- ูุนุงูุฌุฉ ุฐููุฉ ูุญุฏูุฏ ุงูุงุณุชุฎุฏุงู
- ูุธุงู ุชุฎุฒูู ูุญูู ุงุญุชูุงุทู

## ุฏุนู ุฅุถุงูู ๐

ุฅุฐุง ููุช ูุง ุชุฒุงู ุชูุงุฌู ูุดุงูู:

1. **ุชุญูู ูู ุฅุนุฏุงุฏุงุช ุงููุดุฑูุน**: ุชุฃูุฏ ูู ุฃู Project ID ุตุญูุญ
2. **ุฑุงุฌุน ุณุฌูุงุช Firebase**: ูู Firebase Console โ Usage and billing
3. **ุงุฎุชุจุฑ ุงูุงุชุตุงู**: ุงุณุชุฎุฏู ูุญุฏุฉ ุงูุชุญูู ูู ุงููุชุตูุญ
4. **ุชุญูู ูู ุงูููุชุง**: ุชุฃูุฏ ูู ุนุฏู ุชุฌุงูุฒ ุญุฏูุฏ ุงูุฎุทุฉ ุงููุฌุงููุฉ

---

**ููุงุญุธุฉ ูููุฉ**: ูุฐุง ุงูุฅุนุฏุงุฏ ููุตูู ุฎุตูุตุงู ููุนูู ูุน ุงูุฎุทุฉ ุงููุฌุงููุฉ ูู Firebase ููุง ูุชุทูุจ ุชุฑููุฉ ุงูุญุณุงุจ ุฃู ุฏูุน ุฑุณูู ุฅุถุงููุฉ.